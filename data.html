<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Database Feedback</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #fafafa; }
    h2 { margin-bottom: 10px; }
    .controls { margin-bottom: 15px; }
    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    th, td { border: 1px solid #ccc; padding: 6px 8px; text-align: left; }
    th { background: #f0f0f0; position: sticky; top: 0; z-index: 2; }
    tr:nth-child(even) { background: #f9f9f9; }
    button { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; margin-right: 5px; }
    .btn-green { background: #28a745; color: white; }
    .btn-blue { background: #007bff; color: white; }
    input[type="date"] { padding: 4px; }
  </style>
</head>
<body>

  <h2>ðŸ“Š Database Feedback Pelanggan</h2>

  <div class="controls">
    <label>Dari: <input type="date" id="fromDate"></label>
    <label>Sampai: <input type="date" id="toDate"></label>
    <button class="btn-blue" onclick="applyFilter()">Filter</button>
    <button class="btn-green" onclick="saveSelection()">Simpan</button>
    <button class="btn-blue" onclick="exportCSV()">Ekspor CSV</button>
  </div>

  <table id="dataTable">
    <thead>
      <tr>
        <th><input type="checkbox" id="selectAll"></th>
        <th>No</th>
        <th>Tanggal</th>
        <th>Waktu</th>
        <th>Meja</th>
        <th>Nama</th>
        <th>Asal</th>
        <th>Media</th>
        <th>Acara</th>
        <th>Usia</th>
        <th>Makanan</th>
        <th>Minuman</th>
        <th>Penyajian</th>
        <th>Pelayanan</th>
        <th>Kebersihan</th>
        <th>Suasana</th>
        <th>Harga</th>
        <th>Saran</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
let allData = [];

async function loadData() {
  try {
    const res = await fetch("data.json");
    allData = await res.json();
  } catch (e) {
    console.error("Gagal load data.json, pakai dummy.");
    allData = [
      {no:1,tanggal:"2025-07-19",waktu:"07:12",meja:"A1",nama:"Cornelia",asal:"Yogyakarta",media:"Instagram",acara:"Dinner",usia:"25-35",makanan:4,minuman:4,penyajian:3,pelayanan:5,kebersihan:5,suasana:4,harga:4,saran:"So far so good"}
    ];
  }
  renderTable(allData);
}

function renderTable(data) {
  const tbody = document.querySelector("#dataTable tbody");
  tbody.innerHTML = "";
  data.forEach(row => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><input type="checkbox" class="row-check"></td>
      <td>${row.no}</td>
      <td>${row.tanggal}</td>
      <td>${row.waktu}</td>
      <td>${row.meja}</td>
      <td>${row.nama}</td>
      <td>${row.asal}</td>
      <td>${row.media}</td>
      <td>${row.acara}</td>
      <td>${row.usia}</td>
      <td>${row.makanan}</td>
      <td>${row.minuman}</td>
      <td>${row.penyajian}</td>
      <td>${row.pelayanan}</td>
      <td>${row.kebersihan}</td>
      <td>${row.suasana}</td>
      <td>${row.harga}</td>
      <td>${row.saran}</td>
    `;
    tbody.appendChild(tr);
  });
}

// Filter tanggal
function applyFilter() {
  const from = document.getElementById("fromDate").value;
  const to = document.getElementById("toDate").value;
  let filtered = allData;
  if (from) filtered = filtered.filter(r => r.tanggal >= from);
  if (to) filtered = filtered.filter(r => r.tanggal <= to);
  renderTable(filtered);
}

// Simpan (ceklist)
function saveSelection() {
  const checkedRows = [...document.querySelectorAll(".row-check:checked")];
  const selected = checkedRows.map(cb => {
    const row = cb.closest("tr");
    const cells = row.querySelectorAll("td");
    return {
      no: cells[1].innerText,
      nama: cells[5].innerText,
      media: cells[7].innerText,
      saran: cells[17].innerText
    };
  });
  alert("Data tersimpan:\n" + JSON.stringify(selected, null, 2));
}

// Ekspor CSV
function exportCSV() {
  let csv = "";
  const rows = document.querySelectorAll("table tr");
  rows.forEach(row => {
    const cols = row.querySelectorAll("td, th");
    const line = [...cols].map(c => `"${c.innerText}"`).join(",");
    csv += line + "\n";
  });
  const blob = new Blob([csv], { type: "text/csv" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "database_feedback.csv";
  a.click();
}

document.getElementById("selectAll").addEventListener("change", function() {
  const checks = document.querySelectorAll(".row-check");
  checks.forEach(cb => cb.checked = this.checked);
});

loadData();
</script>
</body>
</html>
